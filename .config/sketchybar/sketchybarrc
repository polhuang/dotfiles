#!/bin/bash

# Color Palette
export BLACK=0xff1e1e2e
export WHITE=0xffcdd6f4
export RED=0xfff38ba8
export GREEN=0xffa6e3a1
export BLUE=0xff89b4fa
export YELLOW=0xfff9e2af
export ORANGE=0xfffab387
export MAGENTA=0xffcba6f7
export GREY=0xff6c7086
export TRANSPARENT=0x00000000

# Bar Appearance
export BAR_COLOR=0x801e1e2e
export BAR_BORDER_COLOR=0x80313244
export ITEM_BG_COLOR=0x80313244
export ACCENT_COLOR=0xff89b4fa

PLUGIN_DIR="$CONFIG_DIR/plugins"

# Bar Settings
sketchybar --bar \
  height=26 \
  position=top \
  sticky=on \
  padding_left=10 \
  padding_right=10 \
  color=$BAR_COLOR \
  border_width=1 \
  border_color=$BAR_BORDER_COLOR \
  blur_radius=20 \
  margin=8 \
  corner_radius=9 \
  y_offset=4 \
  shadow=on

# Default Item Settings
sketchybar --default \
  updates=when_shown \
  icon.font="SauceCodeProNerdFontMono-Regular:Regular:16.0" \
  icon.color=$WHITE \
  icon.padding_left=4 \
  icon.padding_right=4 \
  label.font="Fira Code:Medium:9.0" \
  label.color=$WHITE \
  label.padding_left=4 \
  label.padding_right=4 \
  padding_left=4 \
  padding_right=4 \
  background.height=26 \
  background.corner_radius=6 \
  background.border_width=0 \
  popup.background.border_width=2 \
  popup.background.corner_radius=9 \
  popup.background.border_color=$ACCENT_COLOR \
  popup.background.color=$BAR_COLOR \
  popup.blur_radius=20 \
  popup.background.shadow.drawing=on

# Left Side Items

# Spaces
SPACE_ICONS=("1" "2" "3" "4" "5" "6" "7" "8" "9")
for i in "${!SPACE_ICONS[@]}"
do
  sid="$(($i+1))"
  sketchybar --add item space.$sid left \
    --set space.$sid \
    icon="${SPACE_ICONS[i]}" \
    icon.padding_left=4 \
    icon.padding_right=4 \
    icon.font="FiraCode:Medium:11.0" \
    icon.color=0x80cdd6f4 \
    background.color=$TRANSPARENT \
    background.corner_radius=6 \
    background.height=22 \
    background.drawing=off \
    label.drawing=off \
    click_script="open -a 'Mission Control' && sleep 0.1 && osascript -e 'tell application \"System Events\" to key code $((17+$i))'"
done

# Aerospace workspace change listener
sketchybar --add event aerospace_workspace_change

sketchybar --add item aerospace_listener left \
  --set aerospace_listener \
  drawing=off \
  script="$PLUGIN_DIR/aerospace_listener.sh" \
  --subscribe aerospace_listener aerospace_workspace_change

sketchybar --add item space_separator left \
  --set space_separator \
  icon="|" \
  icon.color=$GREY \
  icon.padding_left=8 \
  icon.padding_right=8 \
  label.drawing=off \
  background.drawing=off

# Front App
sketchybar --add item front_app left \
  --set front_app \
  icon.drawing=off \
  background.color=$TRANSPARENT \
  script="$PLUGIN_DIR/front_app.sh" \
  --subscribe front_app front_app_switched

# Center Items - Currently Unused
# You can add items here if desired

# Right Side Items

# Mail
sketchybar --add item mail right \
  --set mail \
  update_freq=60 \
  icon=󰇰 \
  icon.color=$YELLOW \
  background.drawing=off \
  script="$PLUGIN_DIR/mail.sh"

# Calendar
sketchybar --add item calendar right \
  --set calendar \
  update_freq=30 \
  icon=󰃭 \
  icon.color=$MAGENTA \
  background.drawing=off \
  script="$PLUGIN_DIR/calendar.sh" \
  click_script="open -a Calendar"

# Network
sketchybar --add item network right \
  --set network \
  update_freq=5 \
  icon=󰖩 \
  icon.color=$GREEN \
  background.drawing=off \
  script="$PLUGIN_DIR/network.sh"

# CPU
sketchybar --add item cpu right \
  --set cpu \
  update_freq=5 \
  icon=󰘚 \
  icon.color=$ORANGE \
  background.drawing=off \
  script="$PLUGIN_DIR/cpu.sh"

# Memory
sketchybar --add item memory right \
  --set memory \
  update_freq=10 \
  icon=󰍛 \
  icon.color=$BLUE \
  background.drawing=off \
  script="$PLUGIN_DIR/memory.sh"

# Volume
sketchybar --add item volume right \
  --set volume \
  icon=󰕾 \
  icon.color=$GREEN \
  background.drawing=off \
  script="$PLUGIN_DIR/volume.sh" \
  --subscribe volume volume_change

# Battery
sketchybar --add item battery right \
  --set battery \
  update_freq=120 \
  icon=󰁹 \
  icon.color=$YELLOW \
  background.drawing=off \
  script="$PLUGIN_DIR/battery.sh" \
  --subscribe battery system_woke power_source_change

# Clock
sketchybar --add item clock right \
  --set clock \
  update_freq=10 \
  icon=󰥔 \
  icon.color=$ACCENT_COLOR \
  background.drawing=off \
  script="$PLUGIN_DIR/clock.sh"

# Force all scripts to run
sketchybar --update

echo "sketchybar configuration loaded.."
